import{c as S,d as x,q as N,o as U,g as j,a as B,u as I,e as q,b as z,j as V,i as h,n as G,k as $,l as L,m as P,t as f,v as e,z as k,A as C,y as T,B as A,I as v,J as R,E as H,F as w,G as E,H as M,x as y}from"./index-B41RPdAA.js";import{M as J,_ as W}from"./DeleteModal.vue_vue_type_script_setup_true_lang-C2_j-UUp.js";const Y=async i=>{try{const s=S(x,"coupons"),c=N(s,U("title")),t=await j(c),r=[];t.forEach(_=>{r.push({id:_.id,..._.data()})});const l=parseInt(i?.page||"1"),u=10,p=(l-1)*u,b=p+u;return{data:{success:!0,coupons:r.slice(p,b),pagination:{total_pages:Math.ceil(r.length/u),current_page:l,has_pre:l>1,has_next:b<r.length,category:""}}}}catch(s){throw new Error(s.message)}},K=async i=>{try{const s=S(x,"coupons");return{data:{success:!0,message:"已新增優惠券",coupon:{id:(await q(s,i)).id,...i}}}}catch(s){throw new Error(s.message)}},O=async i=>{try{const{id:s,data:c}=i,t=B(x,"coupons",s);return await I(t,c),{data:{success:!0,message:"已更新優惠券",coupon:{id:s,...c}}}}catch(s){throw new Error(s.message)}},Q=async i=>{try{const s=B(x,"coupons",i);return await z(s),{data:{success:!0,message:"已刪除優惠券"}}}catch(s){throw new Error(s.message)}},F=i=>{const s=new Date(i*1e3),c=p=>p<10?"0"+p:p,t=s.getFullYear(),r=c(s.getMonth()+1),l=c(s.getDate());return`${t}-${r}-${l}`},X={class:"modal-dialog modal-dialog-centered modal-lg"},Z={class:"modal-content rounded-lg"},ee={class:"modal-body"},te={class:"mb-3"},oe={class:"mb-3"},se={class:"mb-3"},ae={class:"mb-3"},ne=["value"],le={class:"mb-3 d-flex align-items-center"},de={class:"form-check form-switch"},ie=["checked"],ce={class:"modal-footer"},re=["disabled"],ue=V({__name:"CouponModal",props:{coupon:{},isLoading:{type:Boolean}},setup(i,{expose:s}){const c={id:"",title:"",is_enabled:0,percent:0,due_date:Date.now()/1e3,code:""},t=h(c);G(()=>i.coupon,m=>{t.value=m});const r=$("modalRef");let l=null,u=null;L(()=>{r.value&&(l=new J(r.value))}),P(()=>{l&&l.dispose()});const p=m=>{l&&(l.show(),u=async o=>{try{await m(o),b()}catch{}})},b=()=>{l&&l.hide()},g=()=>{u&&u(t.value)},_=m=>{const o=m.target;t.value.due_date=new Date(o.value).getTime()/1e3};return s({openModal:p,closeModal:b}),(m,o)=>(v(),f("div",{ref_key:"modalRef",ref:r,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",X,[e("div",Z,[o[10]||(o[10]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"couponModalLabel"},"新增優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ee,[e("form",null,[e("div",te,[o[4]||(o[4]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),k(e("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>t.value.title=a),type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣"},null,512),[[C,t.value.title]])]),e("div",oe,[o[5]||(o[5]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),k(e("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.code=a),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024"},null,512),[[C,t.value.code]])]),e("div",se,[o[6]||(o[6]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),k(e("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.percent=a),type:"number",max:"100",min:"0",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折"},null,512),[[C,t.value.percent,void 0,{number:!0}]])]),e("div",ae,[o[7]||(o[7]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),e("input",{value:T(F)(t.value.due_date),onChange:_,type:"date",class:"form-control rounded-lg",id:"couponEndDate"},null,40,ne)]),e("div",le,[o[8]||(o[8]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",de,[k(e("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.is_enabled=a),class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable",checked:!!t.value.is_enabled},null,8,ie),[[A,t.value.is_enabled]])])])])]),e("div",ce,[o[9]||(o[9]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{onClick:g,disabled:i.isLoading,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,re)])])])],512))}}),pe={class:"d-flex justify-content-end align-items-center pe-3 mb-4"},be={key:0,class:"text-center"},me={key:1,class:"card shadow-sm rounded-lg flex-grow-1"},fe={class:"card-body p-4"},ve={class:"table-responsive"},_e={class:"table table-hover align-middle"},ge={class:"text-center"},he={class:"form-check form-switch d-flex justify-content-center align-items-center"},ye=["checked"],ke={class:"text-nowrap"},xe=["onClick"],Ce=["onClick"],we={class:"d-flex justify-content-center mt-4"},Me={class:"pagination"},$e={class:"page-item"},De=["disabled"],Re=["onClick","disabled"],Ee={class:"page-item"},Se=["disabled"],Le=V({__name:"CouponManagement",setup(i){const s={id:"",title:"",is_enabled:0,percent:0,due_date:Date.now()/1e3,code:""},c=h(s),t=h("1"),r=h([]),l=h({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),u=async()=>{try{const a=await Y({page:t.value});r.value=a.data.coupons,l.value=a.data.pagination}catch{alert("取得優惠券列表失敗")}};L(()=>{u()});const p=$("couponModalRef"),b=$("deleteModalRef"),g=h(!1),_=a=>{a?c.value={...a}:c.value=s,p.value?.openModal(async n=>{g.value=!0;try{a?await O({id:n.id,data:{...n,is_enabled:Number(n.is_enabled)}}):await K({...n,is_enabled:Number(n.is_enabled)})}catch{alert("新增/編輯優惠券失敗")}finally{g.value=!1,u()}})},m=a=>{b.value?.openModal(()=>o(a))},o=async a=>{try{await Q(a)}catch{alert("刪除優惠券失敗")}finally{u()}};return(a,n)=>(v(),f(w,null,[e("div",pe,[e("button",{onClick:n[0]||(n[0]=d=>_()),class:"btn btn-dark rounded-lg px-4 py-2",type:"button"},[...n[3]||(n[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),H("新增優惠券 ",-1)])])]),r.value?(v(),f("div",me,[e("div",fe,[e("div",ve,[e("table",_e,[n[4]||(n[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券標題"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"截止日"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(v(!0),f(w,null,E(r.value,d=>(v(),f("tr",{key:d.due_date},[e("td",null,y(d.title),1),e("td",null,y(d.code),1),e("td",null,y(d.percent)+" %",1),e("td",null,y(T(F)(d.due_date)),1),e("td",ge,[e("div",he,[e("input",{style:{"pointer-events":"none"},class:"form-check-input",type:"checkbox",readonly:"",checked:!!d.is_enabled},null,8,ye)])]),e("td",ke,[e("button",{onClick:D=>_(d),class:"btn btn-sm btn-outline-dark rounded-lg me-2",type:"button"}," 編輯 ",8,xe),e("button",{onClick:D=>m(d.id),class:"btn btn-sm btn-outline-danger rounded-lg",type:"button"}," 刪除 ",8,Ce)])]))),128))])])]),e("nav",we,[e("ul",Me,[e("li",$e,[e("button",{onClick:n[1]||(n[1]=d=>t.value=String(Number(t.value)-1)),disabled:!l.value?.has_pre,type:"button",class:M(["page-link",{disabled:!l.value?.has_pre}]),"aria-label":"Previous"},[...n[5]||(n[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,De)]),(v(!0),f(w,null,E(l.value?.total_pages,d=>(v(),f("li",{class:"page-item",key:d},[e("button",{onClick:D=>t.value=d.toString(),disabled:t.value===d.toString(),type:"button",class:M(["page-link",{active:t.value===d.toString()}])},y(d),11,Re)]))),128)),e("li",Ee,[e("button",{onClick:n[2]||(n[2]=d=>t.value=String(Number(t.value)+1)),disabled:l.value?.has_next,class:M(["page-link",{disabled:l.value?.has_next}]),type:"button","aria-label":"Next"},[...n[6]||(n[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,Se)])])])])])):(v(),f("p",be,"目前還沒有優惠券")),R(ue,{ref_key:"couponModalRef",ref:p,coupon:c.value,"is-loading":g.value},null,8,["coupon","is-loading"]),R(W,{ref_key:"deleteModalRef",ref:b,title:"刪除訂單",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{Le as default};
